# Система управления графиком столовой

Веб-приложение для автоматизации формирования графика посещения столовой студенческими группами.

## Описание системы

Приложение позволяет администратору управлять группами студентов и автоматически генерировать график посещения столовой с учетом потоков и временных интервалов. Незарегистрированные пользователи могут просматривать график на сегодня и ближайшую неделю.

## Технические требования

- **PHP**: 7.4 или выше
- **MySQL**: 5.7 или выше
- **Web-сервер**: Apache (Open Server)
- **Браузер**: Современный браузер с поддержкой HTML5

## Установка и настройка

### 1. Установка базы данных

Импортируйте SQL-схему из файла `database.sql`:

```bash
mysql -u root -p < database.sql
```

Или выполните SQL-скрипт через phpMyAdmin.

### 2. Настройка подключения к базе данных

Отредактируйте файл `config/database.php` и укажите параметры подключения:

```php
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'canteen_schedule');
```

### 3. Развертывание на Open Server

1. Скопируйте папку `php-canteen-app` в директорию `domains` вашего Open Server
2. Перезапустите Open Server
3. Откройте браузер и перейдите по адресу: `http://php-canteen-app/public/`

## Структура проекта

```
php-canteen-app/
├── admin/                      # Административная панель
│   ├── index.php              # Главная страница админ-панели
│   ├── view_schedule.php      # Просмотр графика (админ)
│   ├── export_excel.php       # Экспорт графика в Excel
│   └── logout.php             # Выход из системы
├── assets/
│   └── css/
│       └── style.css          # Основные стили приложения
├── config/
│   └── database.php           # Настройки подключения к БД
├── includes/                   # PHP классы и модели
│   ├── Auth.php               # Класс аутентификации
│   ├── Group.php              # Модель групп
│   ├── Schedule.php           # Модель расписания
│   └── ScheduleGenerator.php  # Генератор графиков
├── public/                     # Публичные страницы
│   ├── index.php              # Главная страница (публичный график)
│   ├── login.php              # Страница входа
│   └── search.php             # Поиск по группам
├── database.sql               # SQL-схема базы данных
└── README.md                  # Документация
```

## Учетные данные администратора

**Логин:** pav313  
**Пароль:** sip313

> **Важно:** После первого входа рекомендуется сменить пароль в базе данных.

## Функциональные возможности

### Для администратора:

1. **Управление группами**
   - Добавление новых групп
   - Указание потока (1, 2, 3)
   - Автоматическая генерация количества студентов (20-30)
   - Удаление групп

2. **Генерация графика**
   - Формирование графика на рабочую неделю (Пн-Пт)
   - Автоматическая ротация групп по временным интервалам
   - Распределение групп по потокам с учетом временных ограничений

3. **Просмотр и экспорт**
   - Просмотр графика за любой период
   - Экспорт графика в Excel

### Для незарегистрированных пользователей:

1. **Просмотр графика**
   - График на сегодня
   - График на ближайшую неделю

2. **Поиск**
   - Поиск времени приема пищи по группе и дате
   - Формирование отчета по обеду конкретной группы

## Расписание потоков

- **1 поток групп:** 11:35 - 12:15 (интервал: 5 минут, до 3 групп на слот)
- **2 поток групп:** 13:00 - 13:30 (интервал: 5 минут, до 3 групп на слот)
- **3 поток групп:** 14:15 - 14:30 (интервал: 5 минут, до 3 групп на слот)

## Алгоритм ротации

Система автоматически распределяет группы так, чтобы:
- Каждая группа в течение недели побывала в разных временных интервалах
- Группы одного потока не пересекались во времени
- Нагрузка на временные слоты была равномерной

## База данных

### Таблицы:

- **admins** - Учетные записи администраторов
- **groups** - Студенческие группы
- **schedules** - Сформированные графики

### Связи:

- `schedules.group_id` → `groups.id` (CASCADE DELETE)

## Примеры использования

### Добавление новой группы

1. Войдите в админ-панель
2. В форме "Добавить группу" введите название (например: СИП-113/25)
3. Выберите поток
4. Нажмите "Добавить группу"

### Формирование графика

1. В форме "Сформировать график" выберите начальную дату (понедельник)
2. Выберите конечную дату (пятница той же недели)
3. Нажмите "СФОРМИРОВАТЬ ГРАФИК"
4. График будет автоматически создан с учетом всех правил ротации

### Экспорт в Excel

1. Перейдите в раздел "Просмотреть график (Админ)"
2. Выберите диапазон дат
3. Нажмите "Экспорт в Excel"
4. Файл будет скачан автоматически

## Безопасность

- Все пароли хешируются с использованием `password_hash()`
- Защита от SQL-инъекций через PDO prepared statements
- Проверка прав доступа на всех административных страницах
- Санитизация пользовательского ввода

## Поддержка

При возникновении проблем:
1. Проверьте настройки подключения к БД в `config/database.php`
2. Убедитесь, что база данных создана и содержит необходимые таблицы
3. Проверьте логи ошибок PHP

## Лицензия

Разработано для учебных целей.
